{"version":3,"sources":["icons/point.png","icons/point2.png","icons/plane.png","react-leaflet-icon.js","index.js"],"names":["Point","L","icon","iconUrl","point","iconSize","Point2","point2","Plane","plane","socket","io","path","App","chatContainer","React","createRef","state","userName","isLoggedIn","messages","flights","positions","p2","fp","onButtonClicked","value","c","Date","toString","emit","name","date","message","document","getElementById","buttonUsernameClicked","setState","scrollToMyRef","scroll","current","scrollHeight","clientHeight","scrollTo","on","console","log","connected","data","map","flight","push","origin","code","p","position","toLocaleString","hour","parseInt","slice","final","replace","Fragment","className","MapContainer","center","zoom","scrollWheelZoom","TileLayer","attribution","url","this","Marker","Polyline","smoothFactor","destination","pos","Popup","airline","passengers","pass","age","ref","msg","id","placeholder","type","onClick","aria-label","aria-describedby","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.1b449f97.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/point.ae993290.png\";","export default __webpack_public_path__ + \"static/media/point2.ba3c7903.png\";","export default __webpack_public_path__ + \"static/media/plane.31d92501.png\";","import point from './icons/point.png';\nimport point2 from './icons/point2.png';\nimport plane from './icons/plane.png';\nimport L from 'leaflet';\n\nexport const Point = L.icon({\n  iconUrl: point,\n  iconSize: [15 , 15]\n});\n\nexport const Point2 = L.icon({\n  iconUrl: point2,\n  iconSize: [5 , 5]\n});\n\nexport const Plane = L.icon({\n  iconUrl: plane,\n  iconSize: [45 , 45]\n});","import ReactDOM from 'react-dom';\nimport React, { Component } from 'react';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { io } from \"socket.io-client\";\nimport './index.css';\nimport {Point, Point2, Plane} from './react-leaflet-icon.js';\nimport { MapContainer, TileLayer, Marker, Popup, Polyline } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nconst socket = io(\"wss://tarea-3-websocket.2021-1.tallerdeintegracion.cl/\", {\n  path: '/flights'\n});\n\nexport default class App extends Component {\n  chatContainer = React.createRef();\n  state = {\n    userName: '',\n    isLoggedIn: false,\n    messages: [],\n    flights: [],\n    positions: [],\n    p2: [],\n    fp: {}\n  }\n\n  onButtonClicked = (value) => {\n    var d = new Date();\n    var c = d.toString();\n    socket.emit(\"CHAT\", {name:this.state.userName, date:c, message:value});\n    document.getElementById('message').value = '';\n  }\n  \n  buttonUsernameClicked = (value) => {\n    this.setState({ isLoggedIn: true, userName: value });\n  }\n\n  componentDidMount() {\n    socket.on(\"connect\", () => {\n      console.log(socket.connected);\n    });\n\n    socket.emit(\"FLIGHTS\");\n    socket.on(\"FLIGHTS\", (data) => {\n      console.log(data);\n      this.setState((state) =>\n        ({flights: data})\n      );\n      var positions = [];\n      var fp = {};\n      var c = 0;\n      data.map( flight => {\n        positions.push(flight.origin);\n        fp[flight.code] = c;\n        c += 1;\n        return 1;\n        }\n        )\n      this.setState(\n        {\n          positions\n        }\n      );\n      this.setState(\n        {\n          fp\n        }\n      );\n    });\n\n    socket.on(\"POSITION\", (data) => {\n      var positions = [];\n      this.state.positions.map( p =>\n        positions.push(p)\n        )\n      positions[this.state.fp[data.code]] = data.position;\n      let p2 = [...this.state.p2, data.position];\n      this.setState(\n        {\n          positions\n        }\n      );\n      this.setState(\n        {\n          p2\n        }\n      );\n    });\n\n    socket.on(\"CHAT\", (data) => {\n      var f = new Date(data.date);\n      var c = f.toLocaleString();\n      var hour = (parseInt(c.slice(11,13))).toString()\n      var final = c.slice(0,10).replace(/-/g,\"/\") + ' '+ hour+c.slice(13,16);\n      let messages = [...this.state.messages, {\n        name: data.name,\n        date: final,\n        message: data.message\n      }];\n      if(this.state.isLoggedIn) {\n        this.setState(\n          {\n            messages\n          },\n          () => this.scrollToMyRef()\n        );\n      }\n      else {\n        this.setState(\n          {\n            messages\n          }\n        );\n      }\n    });\n  }\n\n  scrollToMyRef = () => {\n    const scroll = this.chatContainer.current.scrollHeight - this.chatContainer.current.clientHeight; \n    this.chatContainer.current.scrollTo(0, scroll);\n  };\n  //https://codesandbox.io/s/8l2y0o24x9?file=/src/index.js:555-643\n\n  render() {\n    return (\n      <React.Fragment>\n        <div className='fluid-container'>\n          <div className='row'>\n            <div className='col-8'>\n              <h1>Mapa en vivo:</h1>\n              <div className=\"map_box\">\n                <MapContainer center={[0, 0]} zoom={1.4} scrollWheelZoom={true}>\n                  <TileLayer attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors' url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"/>\n                  {this.state.flights.map( flight =>\n                    <Marker position={flight.origin} icon={Point}>\n                      <Polyline smoothFactor={1} positions={[flight.origin, flight.destination]}></Polyline>\n                    </Marker>\n                  )}\n                  {this.state.flights.map( flight =>\n                    <Marker position={flight.destination} icon={Point}></Marker>\n                  )}\n                  {this.state.p2.map( p =>\n                    <Marker position={p} icon={Point2}></Marker>\n                  )}\n                  {this.state.positions.map( pos =>\n                    <Marker position={pos} icon={Plane}>\n                      <Popup>\n                        Code: {pos} <br />\n                      </Popup>\n                    </Marker>\n                  )};\n                </MapContainer>\n              </div>\n              <div className=\"space\"></div>\n              <div className=\"flights_box\">\n                Vuelos:\n                {this.state.flights.map( flight => {\n                  <li key={flight.code}>Code: {flight.code},  Airline: {flight.airline},  Origen: ({flight.origin[0]}, {flight.origin[1]}),  Destino: ({flight.destination[0]}, {flight.destination[1]}),  Plane: {flight.plane}.</li>;\n                  {flight.passengers.map(pass => \n                    <li key={pass.name}>Nombre: {pass.name},  Edad: {pass.age}</li>\n                    )};\n                })}\n              </div>\n            </div>\n            <div className='col-4'>\n              <div>\n              {this.state.isLoggedIn ? \n              <div>\n                <div className='chat_window'>\n                  <div className='top_menu'>\n                    <div className='title'>Centro de Control</div>\n                  </div>\n                  <ul>\n                    <div ref={this.chatContainer} className='Chat'>\n                      {this.state.messages.map( msg => \n                        <li  key={msg.message+msg.date+msg.name}>\n                          <div>\n                            ({msg.date})     {msg.name}: {msg.message}\n                          </div>\n                        </li>\n                        )}\n                    </div>  \n                  </ul>\n                  <div className=\"bottom_wrapper clearfix\">\n                    <div className=\"message_input_wrapper\">\n                      <input id='message' className=\"message_input\" placeholder=\"Escribe algo aquí...\"/>\n                    </div>\n                    <div className=\"send_message\">\n                      <button type=\"button\" className=\"btn btn-outline-primary\" onClick={() => this.onButtonClicked(document.getElementById('message').value)}>Send</button>\n                    </div>\n                  </div>\n                </div>\n              </div>  \n              :\n              <div>\n                <h3>Regístrate para poder chatear!</h3>\n                <div className=\"input-group\">\n                  <input type=\"search\" id='nickname' className=\"form-control rounded\" placeholder=\"Nickname\" aria-label=\"Search\"\n                    aria-describedby=\"search-addon\" />\n                  <button type=\"button\" className=\"btn btn-outline-primary\" onClick={() => this.buttonUsernameClicked(document.getElementById('nickname').value)}>Ingresar</button>\n                </div>\n              </div>  \n              }\n              </div>\n          </div>\n        </div>\n        </div>\n     </React.Fragment> \n    );\n  }\n}    \n\nReactDOM.render(<App />, document.getElementById('root'));"],"sourceRoot":""}